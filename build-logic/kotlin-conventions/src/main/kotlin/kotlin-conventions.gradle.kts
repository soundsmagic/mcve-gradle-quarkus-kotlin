import org.gradle.accessors.dm.LibrariesForLibs

group = "com.husqvarna.amc.epos-cds"
version = "1.0.0-SNAPSHOT"

plugins {
    kotlin("jvm")
    // https://kotlinlang.org/docs/all-open-plugin.html
    kotlin("plugin.allopen")
    id("io.quarkus")
    // Quarkus does not discover CDI beans in different Gradle sub-projects automatically.
    // This unofficial plugin removes the need for specifying a META-INF/beans.xml file manually.
    // https://quarkus.io/guides/gradle-tooling#multi-module-gradle
    id("org.kordamp.gradle.jandex")
}

// Work-around to make the Version Catalog from the "outer" Gradle project
// visible when building this project.
// https://github.com/gradle/gradle/issues/15383#issuecomment-779893192
val libs = the<LibrariesForLibs>()

dependencies {
    implementation(libs.kotlin.logging)
    implementation(enforcedPlatform(libs.quarkus.platform))
    implementation(libs.quarkus.arc)
    implementation(libs.quarkus.kotlin.extension)
    // Required according to Quarkus:
    // https://quarkus.io/guides/kotlin#important-gradle-configuration-points
    implementation(libs.quarkus.kotlin.stdlib)
}

kotlin {
    // https://jakewharton.com/gradle-toolchains-are-rarely-a-good-idea/
    // The critique in the article seems to circle around using old JDKs,
    // or mixing different JDK versions. Not applicable here.
    jvmToolchain(21)
    compilerOptions {
        // Required according to Quarkus:
        // https://quarkus.io/guides/kotlin#important-gradle-configuration-points
        javaParameters.set(true)
    }
}

allOpen {
    annotation("jakarta.enterprise.context.ApplicationScoped")
}

// Required if running tests with QuarkusTest annotation.
// https://quarkus.io/guides/logging#configure-logging-for-quarkustest
tasks.withType<Test> {
    systemProperty("java.util.logging.manager", "org.jboss.logmanager.LogManager")
}

tasks.quarkusDependenciesBuild {
    dependsOn(tasks.jandex)
}